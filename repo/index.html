<html>
<head>
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">
<style type="text/css">
button {margin: 4pt; }
body {padding: 8pt; }
pre {margin-top: 8pt; margin-bottom: 8pt; }
p {margin: 10px 0 0; }
</style>
<script src="//cdnjs.cloudflare.com/ajax/libs/mithril/0.1.9/mithril.js"></script>
<title>Unofficial Ceph ARM APT repository</title>
<script>
var state = {
  debopts: ['debian', 'raspbian'],
  deb: m.prop("debian"),
  distopts: ['wheezy', 'jessie'],
  dist: m.prop("wheezy"),
  branchopts: ['', '-testing'],
  branch: m.prop(""),
  branchdesc: function(branch) {
    if (branch == '') return 'Stable';
    return state.titlecase(branch.substr(1));
  },
  titlecase: function(str) {
    return str.charAt(0).toUpperCase() + str.substr(1).toLowerCase();
  }
};
state.controller = function() {};
state.view = function(s) {
  var selectorrow = function(choices, attr, descfunc) {
    return m("div", {class:"container-fluid"}, choices.map(function(name, index) {
      var desc = state.titlecase(name);
      if (descfunc) desc = descfunc(name);
      return m("div", {class: "col-xs-3 col-sm-2"}, [
        m("button", {
          class: attr()==name ? 'btn btn-primary btn-block' : 'btn btn-block',
          onclick: attr.bind(state, name)
        }, desc)
      ]);
    }));
  };
  return m("div", [
    m("p", "Choose your OS:"),
    selectorrow(state.debopts, state.deb),
    m("p", "Choose which version of Ceph:"),
    selectorrow(state.branchopts, state.branch, state.branchdesc),
    m("div", [
      m("pre", "cat <<EOF > /etc/apt/sources.list.d/cepharm.list\n" +
"deb http://ceph.hufman.me/" + state.deb() + state.branch() + " " + state.dist() + " main\n" +
"deb-src http://ceph.hufman.me/" + state.deb() + state.branch() + " " + state.dist() + " main\n" +
"EOF\n" +
"apt-get update")
    ])
  ]);
};
</script>
</head>
<body>
<p>I've compiled Ceph for ARM in order to run monitor nodes on my Raspberry PI and Sheevaplug. The process is only mildly painful, you just have to pass --disable-tcmalloc to the configure script in debian/rules, and then wait 10 hours for it to compile in a Debian foreign schroot.</p>
<p>I set up a repository to make it easier to install the compiled packages, and decided to let other people have access. Here you go!</p>
<p>You'll want to trust the repo's GPG key:</p>
<pre>gpg --keyserver pgpkeys.mit.edu --recv-key 8A36427511FF3F0F && gpg -a --export 8A36427511FF3F0F | sudo apt-key add -</pre>
<div id="installinstructions">
<p>To install, add the following lines to your apt.sources:
<pre>
cat <<EOF > /etc/apt/sources.list.d/cepharm.list
deb http://ceph.hufman.me/debian wheezy main
deb-src http://ceph.hufman.me/debian wheezy main
EOF
apt-get update
</pre>
<p>Raspbian is similar:</p>
<pre>
cat <<EOF > /etc/apt/sources.list.d/cepharm.list
deb http://ceph.hufman.me/raspbian wheezy main
deb-src http://ceph.hufman.me/raspbian wheezy main
EOF
apt-get update
</pre>
</div>
</body>
<script>
while (window.installinstructions.hasChildNodes()) {
  window.installinstructions.removeChild(window.installinstructions.lastChild);
}
m.module(window.installinstructions, state);
</script>
</html>

